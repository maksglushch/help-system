{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞—è–≤–∫—É</h3>
                </div>
                <div class="card-body">
                    <form method="POST">
                        {{ form.csrf_token }}
                        
                        <div class="mb-3">
                            {{ form.title.label(class="form-label fw-bold") }}
                            {{ form.title(class="form-control") }}
                        </div>

                        <div class="mb-3">
                            {{ form.text.label(class="form-label fw-bold") }}
                            {{ form.text(class="form-control", rows=4) }}
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">–í–∫–∞–∂—ñ—Ç—å –º—ñ—Å—Ü–µ (–ö–ª—ñ–∫–Ω—ñ—Ç—å –ø–æ –∫–∞—Ä—Ç—ñ) üëá</label>
                            <div id="map" style="height: 400px; width: 100%; border-radius: 5px; border: 2px solid #ddd;"></div>
                        </div>

                        <div class="alert alert-secondary">
                            <small>–¢–µ—Ö–Ω—ñ—á–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (–º–∞—é—Ç—å –∑–∞–ø–æ–≤–Ω–∏—Ç–∏—Å—å —Å–∞–º—ñ):</small><br>
                            {{ form.lat(id="lat_field", type="hidden") }}
                            {{ form.lng(id="lng_field", type="hidden") }}
                        </div>

                        <div class="d-grid mt-4">
                            {{ form.submit(class="btn btn-success btn-lg") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
    var map = L.map('map').setView([50.4501, 30.5234], 13);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© OpenStreetMap'
    }).addTo(map);

    var marker;

    function onMapClick(e) {
        if (marker) {
            map.removeLayer(marker);
        }
        marker = L.marker(e.latlng).addTo(map);

        // üî• –ú–ê–ì–ò–Ø –¢–£–¢: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ü–∏—Ñ—Ä—ã –≤ –ø–æ–ª—è
        // –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º value, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–ª—è —Ç–µ–ø–µ—Ä—å –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω—ã Flask-–æ–º
        var latInput = document.getElementById('lat_field');
        var lngInput = document.getElementById('lng_field');
        
        if (latInput && lngInput) {
            latInput.value = e.latlng.lat;
            lngInput.value = e.latlng.lng;
            console.log("–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∑–∞–ø–∏—Å–∞–Ω—ñ:", e.latlng.lat, e.latlng.lng);
        } else {
            alert("–ü–û–ú–ò–õ–ö–ê: –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø–æ–ª—è —Ñ–æ—Ä–º–∏ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç!");
        }
    }

    map.on('click', onMapClick);
</script>
{% endblock %}