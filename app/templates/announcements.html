{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<div class="container mt-4">
  <h2 class="mb-4 text-center fw-bold text-primary">üó∫Ô∏è –ú–∞–ø–∞ –¥–æ–ø–æ–º–æ–≥–∏</h2>
  
  <p class="text-center text-muted">–í–∏–±–µ—Ä—ñ—Ç—å –∑–∞—è–≤–∫—É –ø–æ—Ä—É—á —ñ–∑ –≤–∞–º–∏.</p>

  <div class="card shadow-sm mb-5">
    <div class="card-body p-0">
        <div id="main-map" style="height: 500px; width: 100%; border-radius: 5px;"></div>
    </div>
  </div>

  <h3 class="mb-3">üìã –°–ø–∏—Å–æ–∫ –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –∑–∞—è–≤–æ–∫</h3>

  {% if announcements %}
    <div class="list-group">
      {% for a in announcements %}
        <div class="list-group-item list-group-item-action flex-column align-items-start shadow-sm mb-3 border rounded">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1 fw-bold">{{ a.title }}</h5>
            <small class="text-muted">{{ moment(a.timestamp).fromNow() }}</small>
          </div>
          <p class="mb-1">{{ a.text }}</p>
          <div class="mt-2">
            <small class="text-muted">üë§ {{ a.author.name }}</small>
            
            {% if a.lat and a.lng %}
                <span class="badge bg-info text-dark ms-2">üìç –ù–∞ –º–∞–ø—ñ</span>
            {% endif %}
          </div>
          
          <div class="mt-3">
            <form action="{{ url_for('main.announcements') }}" method="post">
                <input type="hidden" name="announcement_id" value="{{ a.id }}">
                <button type="submit" class="btn btn-primary btn-sm">‚úÖ –ü—Ä–∏–π–Ω—è—Ç–∏ –∑–∞—è–≤–∫—É</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info text-center">
        –ù–∞—Ä–∞–∑—ñ –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞—è–≤–æ–∫. –í—ñ–¥–ø–æ—á–∏–≤–∞–π—Ç–µ! ‚òï
    </div>
  {% endif %}
</div>

<script>
    var map = L.map('main-map').setView([50.4501, 30.5234], 12);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© OpenStreetMap'
    }).addTo(map);

    {% for a in announcements %}
        {% if a.lat and a.lng %}
            L.marker([{{ a.lat }}, {{ a.lng }}]).addTo(map)
                .bindPopup("<b>{{ a.title }}</b><br>{{ a.text|truncate(50) }}");
        {% endif %}
    {% endfor %}
</script>
{% endblock %}