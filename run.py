import os
import sqlalchemy as sa  # <--- ÐžÐ¡Ð¬ Ð¦Ð¬ÐžÐ“Ðž ÐÐ• Ð’Ð˜Ð¡Ð¢ÐÐ§ÐÐ›Ðž
from app import app, db
from flask_migrate import upgrade

# Ð¦ÐµÐ¹ Ð±Ð»Ð¾Ðº Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ 'flask db upgrade' Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ñ– Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ñ–
with app.app_context():
    # Ð¯ÐºÑ‰Ð¾ Ð¼Ð¸ Ð² Ñ–Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñ– (Ð½Ð° Render), Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ”Ð¼Ð¾ Ð»Ð¾Ð³Ñ–ÐºÑƒ
    if os.environ.get('RENDER'):
        print("Ð—Ð°Ð¿ÑƒÑÐº Ð¼Ñ–Ð³Ñ€Ð°Ñ†Ñ–Ñ— Ð±Ð°Ð·Ð¸ Ð´Ð°Ð½Ð¸Ñ…...")
        upgrade()
        print("ÐœÑ–Ð³Ñ€Ð°Ñ†Ñ–Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!")

        # Ð¢Ð¸Ð¼Ñ‡Ð°ÑÐ¾Ð²Ð¸Ð¹ ÐºÐ¾Ð´ Ð´Ð»Ñ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð°Ð´Ð¼Ñ–Ð½Ð°
        from app.models import User
        
        # Ð¨ÑƒÐºÐ°Ñ”Ð¼Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°
        print("Ð¨ÑƒÐºÐ°Ñ”Ð¼Ð¾ ÐœÐ°ÐºÑÐ¸Ð¼Ð°...")
        user = db.session.scalar(sa.select(User).where(User.name == 'ÐœÐ°ÐºÑÐ¸Ð¼ Ð“Ð»ÑƒÑ‰ÐµÐ½ÐºÐ¾'))
        
        if user:
            user.role = 'admin'
            db.session.commit()
            print("Ð£Ð Ð! ÐœÐ°ÐºÑÐ¸Ð¼ Ñ‚ÐµÐ¿ÐµÑ€ ÐÐ´Ð¼Ñ–Ð½! ðŸ¦¸â€â™‚ï¸")
        else:
            print("Ð¥Ð¼Ð¼, ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° 'ÐœÐ°ÐºÑÐ¸Ð¼ Ð“Ð»ÑƒÑ‰ÐµÐ½ÐºÐ¾' Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾. ÐœÐ¾Ð¶Ðµ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° Ð² Ñ–Ð¼ÐµÐ½Ñ–?")

if __name__ == '__main__':
    app.run()